// (c)2013 Jorge Colombo - jcolombo@ymail.com - t: @jcolombo_ - f: /Jorge Colombo

(function(window,$){'use strict';function AjaxGrails(serverURL,username,password,remember){version='1.2';var self=this,auth=false,logId=0,lang='',lastLang='',HDR_LOGGED='XXX-Logged',HDR_LOCATION='Location',_retry401=false,_flogin=false,_frelogin=false,_earlyCheck=false;this.debugLevel=0;this.serverURL=serverURL||'';this.username=username;this.password=password;this.remember=remember;this.loginData={};this.isAutoOn401=true;this.SS={rem:'_spring_security_remember_me',pass:'j_password',user:'j_username',login:'j_spring_security_check',logout:'j_spring_security_logout',fld_LoggedIn:'_loggedIn',remCheck:'login/ajaxRecheck'};this.cross=(serverURL.toLowerCase()!=(location.protocol+'//'+location.hostname+(location.port!=80?':'+location.port:'')).toLowerCase());this.toString=function(){return'** AjaxGrails to '+this.serverURL+' - Auth: ('+this.username+', '+this.password+') is Login: '+(auth?'IN':'OUT')+' **';};this.version=function(){return version;};function _rvErr(xhr){return{success:false,error:xhr.status+' '+xhr.statusText,status:xhr.status,hLogged:xhr.getResponseHeader(HDR_LOGGED),hLocation:xhr.getResponseHeader(HDR_LOCATION),xhr:xhr};};function setAuth(d){auth=d.result[self.SS.fld_LoggedIn]?true:false;self.loginData=d.result;self.loginData._loginDate=new Date();log(self.toString(),-1);};function resetAuth(){auth=false;self.loginData={};};function earlyCheck(url,cback){if(!_earlyCheck&&!auth&&!_flogin&&url.search(self.SS.remCheck)<0&&url.search(self.SS.logout)<0&&url.search(self.SS.login)<0&&self.username){_earlyCheck=true;log(" ... early check for login status ...",-1);self.check(cback);}else if(cback){cback();}};function _chk401(xhr,text,method,url,options,sus,err,alw,lid){if(self.isAutoOn401&&!_retry401&&xhr.status==401&&self.username){_retry401=true;log(' ... --- auto-retry due 401 is ON --- ',lid);self.relogin(function(d){_retry401=false;log(' ... --- auto-retry OFF --- ',lid);if(auth){doAjax(method,url,options,sus,err,alw);};});};if(err&&!_retry401)err(_rvErr(xhr));};function doAjax(method,url,options,sus,err,alw){options=$.extend({type:method,async:true},options);if(self.username)options=$.extend({xhrFields:{withCredentials:true}},options);options.data=$.extend({ajax:true},options.data);if(self.lang&&self.lang!=self.lastLang){$.extend(options.data,{lang:self.lang});self.lastLang=self.lang;};var ops=$.extend({dataType:"json",crossDomain:self.cross,url:self.serverURL+url},options);debug('request options:',ops);var lid=log(method+' '+url);var req=$.ajax(ops);req.always(function(dorxhr,text){if(alw)alw(dorxhr,text);});req.done(function(d,text,xhr){log(' ...done: '+ddrill(d),lid);earlyCheck(url,function(){if(sus)sus({success:true,result:d});});});req.fail(function(xhr,text){log(' ...FAIL: '+text+' ('+xhr.status+' '+xhr.statusText+')',lid);_chk401(xhr,text,method,url,options,sus,err,alw,lid);});};this.isAuth=function(){return auth;};this.get=function(url,cback,options){doAjax('GET',url,options,cback,cback);};this.post=function(url,cback,options){doAjax('POST',url,options,cback,cback);};this.relogin=function(cback){_frelogin=true;return self.login(cback);};this.login=function(cback){if(!_flogin&&self.username){var doit=function(){_flogin=true;resetAuth();var data={};data['_'+(self.SS.rem)]='';data[self.SS.pass]=self.password;data[self.SS.user]=self.username;data.controller=self.SS.login;if(self.remember)data[self.SS.rem]='on';doAjax('POST','/'+self.SS.login,{data:data},function(d,t,xhr){if(d.success&&d.success==true){setAuth(d);};if(cback){cback(d);};},function(xhr,text){if(cback){cback(_rvErr(xhr));};},function(dorxhr,text){_flogin=false;});};if(_frelogin){doAjax('GET','/'+this.SS.logout,{},null,null,doit);}else{self.check(function(r){if(!auth||!self.loginData||self.loginData.username!=self.username)doit();else{if(cback){cback({success:true,result:self.loginData});};_flogin=false;}});};};_frelogin=false;};this.logout=function(cback){if(_flogin||(!self.username&&!auth))return false;doAjax('GET','/'+this.SS.logout,{dataType:"text"},function(d){if(cback){cback(d)};resetAuth();log(self.toString(),-1);},cback);};this.check=function(cback){if(_flogin)return false;resetAuth();doAjax('GET','/'+this.SS.remCheck,{},function(d,t,xhr){if(d.success&&d.success==true){setAuth(d);};if(cback){cback(d);};},function(xhr,text){if(cback){cback(_rvErr(xhr));};});};this.setAuthData=function(u,p,r){if(typeof u==='object'){self.username=u.j_username||u.username||u.user;self.password=u.j_password||u.password||u.pass;self.remember=u.j_remember_me||u.remember_me||u.remember||u.rem;}else{self.username=u;self.password=p;self.remember=r;};resetAuth();};this.setLanguage=function(l){self.lang=l;};function ddrill(d,p){if(typeof(d)!=='object')return d;var t;for(var x in d){t=(t?t+', ':'')+x+': '+ddrill(d[x]);};return'{'+t+'}';};function debug(cap,d){if(self.debugLevel<2)return;var txt=ddrill(d);if(txt)console.info('<<AJAX>>  '+cap+'\n'+txt);};function log(t,lid){if(self.debugLevel<1)return 0;if(!lid||lid==0)lid=++logId;console.info((lid>0?'[ '+lid+' ] ':'\t'),(t.length>220?t.slice(0,216)+'...':t).replace(/[\n\f\t\r]+/,' '));return lid;};};window.newAjaxGrails=function(args){return new AjaxGrails(args);};}(window,jQuery));(function(window){'use strict';function TExpreso(){var self=this,VERSION='1.4',rexp={DBEG:'\\{\\{',DEND:'\\}\\}'},cache,MEM,rexpHlps;this.reset=function(){cache={tpl:{},hlp:{}};MEM={};rexpHlps={};self.addHelper('set',_h_set);self.addHelper('if',_h_if);self.addHelper('|',_h_bar);self.addHelper('|set',_h_barSet);self.addHelper('trim',_h_trim);self.overwrite=false;self.VERSION=VERSION;self.ME='TExpreso v.'+VERSION;};this.add=function(tname,str,overwrite,addInterceptor){if(cache.tpl[tname]&&!(overwrite||self.overwrite)){console.info('try overwrite template: '+tname);return false;};self.tname=tname;self.error='';var tpl=typeof addInterceptor==='function'?_parse(addInterceptor(tname,str)):_parse(str);if(tpl)cache.tpl[tname]=tpl;else if(cache.tpl[tname])cache.tpl[tname]=undefined;return tpl;};this.addHelper=function(name,fn,overwrite,rexpp){var rv;self.tname=name;self.error='';if(typeof fn!=='function')_error('Invalid helper add');else if(cache.hlp[name]&&!(overwrite||self.overwrite))console.info('try overwrite helper: '+name);else{cache.hlp[name]=fn;rv=true;if(rexpp)rexpHlps[name]=rexpp;};return rv;};this.render=function(tname,scope,retainMem){var tpl=cache.tpl[tname];self.tname=tname;self.error='';MEM=typeof retainMem=='object'?retainMem:!retainMem?MEM={}:MEM;if(tpl)return _rend(tpl.T,(scope?scope:{}));_error('Template '+tname+' not found');return'';};this.express=function(arg1,arg2,arg3){var sco=(arg3!==undefined?arg3:arg2),rv='',e;self.tname='???';self.error='';if(!/^[\w-:\.]+$/g.test(arg1))return _rend(_parse(arg1)['T'],sco);if(!cache.tpl[arg1])if((e=window.document.getElementById(arg1))){self.add(arg1,e.text);console.info('agrega '+arg1);};if((rv=self.render(arg1,sco)))if((e=window.document.getElementById(arg2)))e.innerHTML=rv;return rv;};this.get=function(tname){return cache.tpl[tname];};this.has=function(tname,ttype){return((ttype=='helper'?cache.hlp[tname]:cache.tpl[tname])?true:false);};this.names=function(ttype){var rv=[],obj=ttype=='helper'?cache.hlp:cache.tpl;for(var i in obj){rv.push(i);};return rv;};this.delimiter=function(s){if(s=='['||s==']'){rexp.DBEG='\\[\\[';rexp.DEND='\\]\\]';}else if(s=='('||s==')'){rexp.DBEG='\\(\\(';rexp.DEND='\\)\\)';}else{rexp.DBEG='\\{\\{';rexp.DEND='\\}\\}';};};function _rend(node,scope){if(!node)return'';var buf='';for(var i in node){if(typeof node[i]==='string')buf+=_rendStr(node[i],scope);else{var ok=false,fn,op=node[i].op;if((fn=cache.hlp[op[1]])){var t=function(sc){return _rend(node[i].T,_doScope(sc,scope));};var e=function(sc){return node[i].E?_rend(node[i].E,_doScope(sc,scope)):'';};buf+=fn({T:t,E:e,op:op,s:scope,m:MEM,get:_get,_getx:_getx,_error:_error,cache:cache});ok=true;}else{var x=op.length==2?_get(scope,op[1]):null,inv=op[0]=='^';if(((!!x||x===0)&&!inv)||((!x&&x!==0)&&inv)){if(x instanceof Array){if(x.length>0){for(var j in x){var row=typeof x[j]==='object'?x[j]:{'%content':x[j]};row['%index']=parseInt(j);row['%row']=parseInt(j)+1;row['%length']=x.length;buf+=_rend(node[i].T,_doScope(row,scope));};ok=true;}}else{buf+=_rend(node[i].T,((x instanceof Object)?_doScope(x,scope):scope));ok=true;}}};if(!ok&&node[i].E){buf+=_rend(node[i].E,scope);}}};return buf;};function _rendStr(str,scope){var pp,bp,np=0;var buf='',m,pat=new RegExp(rexp.DBEG+'\\s*[^'+rexp.DEND+']+\\s*'+rexp.DEND,'gm');while((m=pat.exec(str))){pp=np;bp=m.index;np=m[0].length+m.index;buf+=_rmvcms(str.substring(pp,bp));var op=_opMaker(str.substring(bp,np));if(op[0]==='>'){buf+=self.render(op[1],scope,true);}else{var fn,x=op.length==2?_get(scope,op[1]):null;if(x||x===0)buf+=x;else if((fn=cache.hlp[op[1]])){buf+=fn({op:op,s:scope,m:MEM,get:_get,_getx:_getx,_error:_error,cache:cache});}}};return buf+_rmvcms(str.substring(np,str.length));};function _rmvcms(str){return str.replace(/\/+\*.+?\*\//g,'');};function _doScope(loc,parent){if(typeof parent==='object'&&loc!==parent)loc['..']=parent;return loc;};function _parse(str){if(!str)return null;var node=_new(0),curr=node,m,x,deep=0,pp,bp,np=0,pat=new RegExp(rexp.DBEG+'\\s*(end|else|[#\\^].+?)\\s*'+rexp.DEND,'gm');function _xget(){return str.substring(pp,bp);};function _new(d,o){return{d:d,op:o,f:-1}};function _push(o,v){if(!v)return;var ix=o.f<0?'T':o.f<255?'I'+o.f:'E';if(o[ix]===undefined)o[ix]=[v];else o[ix].push(v);};curr.op=['prog'];while((m=pat.exec(str))){pp=np;bp=m.index;np=m[0].length+m.index;x=_new(null,_opMaker(str.substring(bp,np)));if(/\^|#/.test(x.op[0])){_push(curr,_xget());_push(curr,x);x.d=++deep;x.p=curr;curr=x;}else if(x.op[1]==='else'){if(!curr||curr===undefined||curr.d==0||curr.f>=255){_error('invalid spare "else" for: '+(curr&&curr.op[1]?curr.op[1]:'??'));return null;};_push(curr,_xget());curr.f=255;}else if(x.op[1]==='end'){_push(curr,_xget());curr=curr.p;deep--;if(!curr){_error('invalid spare "end"');return null;};};};pp=np;bp=str.length;_push(curr,_xget());if(!curr||curr.d>0){_error('missing any "end"');return null;};return node;};function _epat(s,pat){var c,arr=[];while((c=pat.exec(s))){arr.push(c[0].trim());};return arr;};function _opMaker(s){var rv,c,re=new RegExp(rexp.DBEG+'|'+rexp.DEND);var arr=_epat((s.split(re))[1],/"[^"]+?"|""|\s*[^"\s]+/g);var b=arr.shift();if((c=b.charAt(0))&&(c==='>'||c==='#'||c==='^')){rv=[c];if((c=b.slice(1)))rv.push(c);}else{rv=['',b];};for(var i in arr){if(!arr[i])continue;if(rv.length==2&&(c=rexpHlps[rv[1]]))rv=rv.concat(_epat(arr[i],c));else rv.push(arr[i]);};return rv;};function _get(o,p){var r,s,mem;try{if(p=='true')r=true;else if(/^["'].+["']$/.test(p))r=p.substring(1,p.length-1);else if(/^\d+\.?\d*$/.test(p))r=p;else if(/^\.?[%\$\w][\w\.\$]*$/.test(p)){try{r=mem=p.charAt(0)=='$'?MEM:o,s=p.charAt(0)=='.'?p.slice(1).split('.'):p.split('.');for(var i in s){r=r[s[i]];};}catch(x){r=undefined};if(r===undefined&&mem['..']&&p.charAt(0)=='.')r=_get(mem['..'],p);};}catch(x){};return r;};function _getx(op,scope){var pars=[],ps=op.slice(2);for(var i in ps){pars.push(_get(scope,ps[i])||'');};return pars;};function _error(m){self.error=m='[ template: '+self.tname+' ] '+m;console.error(m,' ');};function _h_set(options){var vals=options._getx(options.op,options.s);var sfx=function(p,v){if(/^\$\w+$/.test(p))MEM[p]=v;else options._error('invalid var in "set": "'+p+'"');};if(typeof options.T=='function'){sfx((options.op[2]||''),options.T(options.s));}else{vals.shift();sfx((options.op[2].replace('=','')||''),(typeof vals[0]=='object'?vals[0]:(vals.join('')||'')));};return'';};function _h_if(options){var v;if(typeof options.T!=='function'){options._error('invalid "if" (should be #if)');return'';};var rx=/[%\$a-z\.][\w\.\$]*|["'][^"]+?["']/ig;var x,cond='',pp,np=0,bp,m;try{var expr=options.op.slice(2).join(' ');while((m=rx.exec(expr))){pp=np;bp=m.index;np=m[0].length+m.index;cond+=expr.substring(pp,bp);cond+=(/^[\."']|true|false|null|undefined|NaN|Infinity/.test(m[0])?'':'this.')+m[0];};cond="return ("+cond+expr.slice(np)+");";var ctx={};for(var i in options.s){ctx[i]=options.s[i];};for(var i in options.m){ctx[i]=options.m[i];};var nf=new Function(cond);v=nf.call(ctx);}catch(x){options._error(x+' (in "if" condition)');};return(v?options.T(options.s):options.E(options.s));};function _h_bar(options){var rv='',vals=options._getx(options.op,options.s);for(var i in vals){if(vals[i]&&typeof vals[i]!='object'){rv=vals[i];break;}};if(typeof options.T=='function'&&!rv)rv=options.T(options.s);if(options.E)options._error('invalid "else" in bar helper "|"');return rv;};function _h_barSet(options){var p=options.op.splice(2,1);if(/^\$\w+$/.test(p))MEM[p]=_h_bar(options);else options._error('invalid var in "|set": "'+p+'"');return'';};function _h_trim(options){var rv='';if(typeof options.T=='function')rv=options.T(options.s);else if(options.E)options._error('invalid spare "else" in trim helper');else options._error('invalid trim helper');return rv?(rv+'').trim():'';};self.reset();};window.TExpreso=new TExpreso();}(window));(function($,window){'use strict';var VERSION='1.1',urls=[],ATTR_TPL_NAME='data-te-name',ATTR_TPL_TYPE='data-te-type',options={addInterceptor:null,templateType:'text/html',};function getTExpreso(){if(window.TExpreso==undefined){$.error("Failed to obtain TExpreso v1.x, you must load it!");return;};return window.TExpreso;};function has(tname,ttype){return getTExpreso().has(tname,ttype);};function hasUrl(tname){return urls.indexOf(tname)>=0};function getStatsInfo(){var af=function(x){x=x?x:'template';var ns=getTExpreso().names(x);return x+'s: '+(ns.length>0?ns.length+' ['+ns.join(', ')+']':'(no)');};return $.TExpreso.ME+' >> '+af()+', '+af('helper');};function addFromString(tname,thtml,ttype,overwrite){var rv;if(tname&&ttype&&thtml){if(ttype=='helper')rv=getTExpreso().addHelper(tname,eval(thtml),overwrite);else rv=getTExpreso().add(tname,thtml,overwrite,options.addInterceptor);};return!!rv?1:0;};function addFromUrl(url,doit,overwrite){if(!url||(!overwrite&&hasUrl(url))){if(doit)doit(0);return;};var cant=0;return $.ajax({url:url,dataType:'text',}).done(function(d){$(d.trim()).filter('script').each(function(i,el){var rv=false,id=$(el).attr(ATTR_TPL_NAME),ttype=$(el).attr(ATTR_TPL_TYPE);if(ttype=='helper')rv=getTExpreso().addHelper((id?id:el.id),eval($(el).html()),overwrite);else rv=getTExpreso().add((id?id:el.id),$(el).html(),overwrite,options.addInterceptor);if(rv)cant++;});}).always(function(){urls.push(url);if(doit)doit(cant,url);});};function addFromDom(id){var _normalize=function(e){if(e.tagName!=='SCRIPT'){var $scr=$('<script type="'+options.templateType+'">');$scr.html($(e).html());var dn=$(e).attr(ATTR_TPL_NAME),dt=$(e).attr(ATTR_TPL_TYPE),id=e.id;$(e).remove();$scr.attr('id',id);if(dn)$scr.attr(ATTR_TPL_NAME,dn);if(dt)$scr.attr(ATTR_TPL_TYPE,dt);$('body').append($scr);}};var cant=0,ids=id?[id]:$('script[type="'+options.templateType+'"]').map(function(){_normalize(this);return this.id;});$.each(ids,function(){var rv,el=document.getElementById(this);if(el===null)$.error('script id not found: #'+this);else{if($(el).attr(ATTR_TPL_TYPE)=='helper')rv=getTExpreso().addHelper(this,eval($(el).html()));else rv=getTExpreso().add(this,$(el).html(),false,options.addInterceptor);if(rv)cant++;}});return cant;};$.TExpreso={VERSION:VERSION,ME:'jQuery TExpreso v.'+VERSION+' ( '+getTExpreso().ME+' )',setAddInterceptor:function(fn){options.addInterceptor=fn;},addFromString:addFromString,addFromDom:addFromDom,addFromUrl:addFromUrl,getStatsInfo:getStatsInfo,getNames:getTExpreso().names,has:has,hasUrl:hasUrl,TExpreso:getTExpreso(),};$.fn.texpreso=function(tpl,data,retainMem){var inst=getTExpreso();return this.each(function(){$(this).html(inst.render(tpl,data,retainMem));});};$.fn.TExpreso=$.fn.texpreso;}(jQuery,window));(function(window){'use strict';var adapt=function(o,ns){if(!o.type){if(typeof o==='object'){for(var i in o){if(o instanceof Array)adapt(o[i],(ns?ns+'['+i+']':''));else adapt(o[i],(ns?ns+'.':'')+i);};};return;};o.name=o.name?o.name:ns;o._$isInput=!!(String(o.type)).match(/^(text|password|url|search|email|time|date|datetime|number|color|tel)$/i);o._$isText=(!o.type||o.type=='text');o._$isTextarea=(o.type=='textarea');o._$isPassword=(o.type=='password');o._$isCheckbox=(o.type=='checkbox');o._$isRadio=(o.type=='radio');o._$isCheckboxOrRadio=(o.type=='checkbox'||o.type=='radio');o._$isSelect=(o.type=='select');o._$isHidden=(o.type=='hidden');o._$isTablelist=(o.type=='tablelist');o._$aType=o.type?"type='"+o.type+"'":"type='text'";o._$aId=o.id?"id='"+o.id+"'":undefined;o._$aPlaceholder=o.placeholder?"placeholder='"+o.placeholder+"'":undefined;o._$aName=o.name?"name='"+o.name+"'":undefined;o._$aValue=o.value&&o.type!='radio'?"value='"+o.value+"'":undefined;o._$aChecked=o.checked?"checked":undefined;o._$aRequired=o.required?"required":undefined;o._$aReadonly=o.readonly?"readonly":undefined;o._$aRows=o.rows?"rows='"+o.rows+"'":undefined;if(o._$isSelect||o._$isRadio){var arr=['_$aChecked','checked'];if(o._$isSelect){arr=['_$aSelected','selected'];o.value=o.value?o.value:o.options.length>0?o.options[0].value?o.options[0].value:o.options[0].text:"";o._$aSize=o.size>1?"size='"+o.size+"'":undefined;o._$aMultiple=o.multiple?"multiple":undefined;};for(var j in o.options){if(o.options[j].value==o.value||o.options[j].text==o.value)o.options[j][arr[0]]=arr[1];else o.options[j][arr[0]]=undefined;o.options[j]._$aValue=o.options[j].value?"value='"+o.options[j].value+"'":"";o.options[j]._$aId=o.id?"id='"+o.id+"-"+j+"'":undefined;}};};if(!window.dataAdapter)window.dataAdapter=adapt;}(window));(function(window,$){'use strict';if(!$)console.error('PaginatorGrails requiere jQuery para funcionar !');function PaginatorGrails(args){var self=this,P='_paginator',C='_columns',pars=$.extend({max:10,maxpages:12,signs:{lsign:'&laquo;',rsign:'&raquo;',lxsign:'&larr;',rxsign:'&rarr;',usign:{icon:'chevron-up'},dsign:{icon:'chevron-down'}},sizes:{label:'Paginado',options:[{value:5},{value:10},{value:15},{value:25},{value:50},{value:100}]},},args);this.params=function(){return $.extend({},{max:10,offset:0},{max:pars.max,offset:pars.offset,sort:pars.sort,order:pars.order});};this.update=function(d){d[P].signs=$.extend(d[P].signs||{},pars.signs);d[P].max=Math.max(d[P].max||10,2);d[P].offset=Math.max(d[P].offset||0,0);d[P].total=Math.max(d[P].total||0,0);pars.link=(pars.link&&pars.link.charAt(0)!='#')?'#'+pars.link:pars.link;$.extend(pars,d[P]);var tlast,first=1;var last=tlast=Math.max(Math.ceil(d[P].total/d[P].max),1);var curr=Math.ceil((d[P].offset+1)/d[P].max);var exc=(tlast>pars.maxpages),pages=[],cpars=self.params();d[P]['lexc']=d[P]['rexc']=false;if(exc){var med=Math.floor(pars.maxpages/2);first=Math.max(curr-med,1);last=Math.min(first+pars.maxpages-1,tlast);if(first>pars.maxpages){cpars.offset=(first-med-1)*pars.max;d[P]['lexc']={link:'?'+$.param(cpars)+pars.link,value:"<<"};};if((last+pars.maxpages)<tlast){cpars.offset=(last+med)*pars.max;d[P]['rexc']={link:'?'+$.param(cpars)+pars.link,value:">>"};}};for(var pnum=first;pnum<=last;pnum++){cpars.offset=(pnum-1)*pars.max;pages.push((curr==pnum?{link:'#_',active:'active',value:pnum}:{link:'?'+$.param(cpars)+pars.link,value:pnum}));};d[P]['larrow']=curr==first?{disabled:'disabled',link:'#_'}:pages[curr-first-1];d[P]['rarrow']=curr==last?{disabled:'disabled',link:'#_'}:pages[curr-first+1];d[P]['pages']=pages;cpars.offset=(curr-1)*pars.max;var ss=(pars.order||'asc')=='asc'?pars.signs.usign:pars.signs.dsign;for(var i in d[C]){if(d[C][i].sort){if(i==pars.sort)cpars.order=(pars.order||'asc')=='asc'?'desc':'asc';else cpars.order=pars.order;cpars.sort=i;$.extend(d[C][i],{sign:i==pars.sort?ss:false,link:'?'+$.param(cpars)+pars.link});}else $.extend(d[C][i],{sign:false});};d[P].sizes=d[P].sizes||pars.sizes;if(d[P].sizes.options){cpars=self.params();for(var i in d[P].sizes.options){cpars.max=d[P].sizes.options[i].value;d[P].sizes.options[i].link='?'+$.param(cpars)+pars.link;}};return pars;};};window.newPaginatorGrails=function(args){return new PaginatorGrails(args);};}(window,jQuery));var docCookies={getItem:function(sKey){return decodeURI(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURI(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)){return false;};var sExpires="";if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString();break;}};document.cookie=encodeURI(sKey)+"="+encodeURI(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");return true;},removeItem:function(sKey,sPath,sDomain){if(!sKey||!this.hasItem(sKey)){return false;};document.cookie=encodeURI(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"");return true;},hasItem:function(sKey){return(new RegExp("(?:^|;\\s*)"+encodeURI(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie);},keys:function(){var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var nIdx=0;nIdx<aKeys.length;nIdx++){aKeys[nIdx]=decodeURI(aKeys[nIdx]);};return aKeys;}};(function(window,$,docCookies){function ClientMVC(){var self=this,global={serverPath:'/'+String(window.location.pathname).split('/')[1]},IAM="ClientMVC",IAM_ERROR=IAM+" ERROR: ",VERSION="2.0",ROUTE_ERROR="'hash' ignored!, must be a string without strange characters",LOADER_ROUTE="_LOAD_",ATTR_DATA_PARTIAL="data-partial",ATTR_DATA_ONCHANGE="data-onchange",ATTR_DATA_SECTIONKEY="data-sectionkey",ATTR_DATA_BACKBTN="data-backbtn",ATTR_DATA_LANG="data-lang",APPENDVIEW_SELECTOR=".row,.row-fluid,.container,.container-fluid",LANGUAGE="es",SYMB_LANG="%LANG%",COOKIE_LANG=IAM+"_LANG",timer,started,inHBackFlag,routes=[],othersLoaded,updQueue={},hdeep=0,currentRoute,previousRoute,PARSEPAT=/[\s,]+/g,HTTPMATCH=/https*:/i;if(!($&&window.TExpreso&&$.TExpreso&&docCookies)){console.error(IAM_ERROR,"Missing any dependencies: JQuery 1.5+, TExpreso 1.1+, JQuery TExpreso 1.3+, docCookies");return;};var options={autoStart:true,viewId:"viewId",AG:null,others:null,appPath:"../",sufixURI:"",tplExtension:".html",loadErrorMsg:"<b>... error de carga de página ...</b>",startOnlyOnce:false,onFault:defaultFault,dataAdapter:function(o){return o;}};$.extend(this,{debugLevel:0,LOADER:LOADER_ROUTE,});function defaultFault(ctx,d){var o=ctx||options,text;if(!d)text=o.loadErrorMsg;else if(d.status==401)text='ERROR: '+d.error+'   (Logged: '+d.hLogged+', Location: '+d.hLocation+')';else text='ERROR: '+d.error;alert(text);};function getInputValue(e){return(!String(e.type).match(/(checkbox|radio)/i)?e.value:(e.value.match(/(on|true|false)/i)?(e.checked?true:false):(e.checked?e.value:"")));};function getInputName(e){return e.name;};function _oget(obj,sn){try{var m=obj,ss=sn.split('.');for(var i in ss){m=m[ss[i]];};return m;}catch(x){};return;};function updateModel(route,n,v){var o=_oget(route.model,n);if(o!==undefined){if(o.type=='checkbox')o.checked=v;else o.value=v;options.dataAdapter(o);}};function updateHots(elemName,route){hdeep++;var elems=[],rends=[];$("["+ATTR_DATA_ONCHANGE+"]").each(function(i,e){if(!e.id||rends.indexOf(e.id)<0){rends.push(e.id);var oca=($(e).attr(ATTR_DATA_ONCHANGE)||"").split(PARSEPAT);if(oca.indexOf("*")>-1||oca.indexOf(elemName)>-1){var ctx=$.extend({elemName:elemName},route);if(typeof ctx.onChange=='function'){var sk=$(e).attr(ATTR_DATA_SECTIONKEY);deferred(ctx,ctx.onChange,function(){pushToUpdView((sk?sk:e.id?('#'+e.id):null),elemName);if(hdeep==0)processUdpQueue(ctx);});ctx.proceed(ctx);ctx.resolve();}}}});hdeep--;};function processUdpQueue(route){for(var i in updQueue){if(i.charAt(0)=='#')updQueue[i].elems=$(i).get();else updQueue[i].elems=$("["+ATTR_DATA_SECTIONKEY+"='"+i+"']").get();};var e,chain=[];for(var j in updQueue){var elems=updQueue[j].elems;if(elems.length<1)continue;var cause=updQueue[j].cause;log(".processUdpQueue() caused by: '"+cause+"'");for(var i in elems){e=elems[i];var sk=$(e).attr(ATTR_DATA_SECTIONKEY),tpl=$(e).attr(ATTR_DATA_PARTIAL);var obj=sk?_oget(route.model,sk):route.model;$(e).TExpreso(tpl,obj);$(e).find("input,select").not(":button,:reset,:submit").change(function(){return inputCallback(this,route);});$(e).find("button,a,input[type='button']").not(":submit").click(function(){return inputCallback(this,route);});$(e).find("form").submit(function(){return inputCallback(this,route);});$(e).find("["+ATTR_DATA_BACKBTN+"]").click(function(){return backBtnCallback(this);});log("\tre-render sectionkey or #id '"+(sk?sk:'#'+e.id)+"' with partial-template: '"+tpl+"'");sk?chain.push(sk):e.id?chain.push('#'+e.id):null;}};updQueue={};for(var i in chain){updateHots(chain[i],route);}};function inputCallback(elem,route){var rv=false,alink,ctx=$.extend({elem:elem},route);var tagType=String(elem.tagName==='FORM'?'submit':elem.tagName==='A'?'a':elem.type).toLowerCase();if(tagType.match(/^(a|button|submit)$/i)){rv=true;if(tagType==='submit'){if(!$(elem).attr("action")&&elem.name)$(elem).attr("action",elem.name);alink=$(elem).attr("action");$.extend(ctx,{data:getFORMData(elem),actionLink:alink,type:'submit'});}else if(tagType==='a'){alink=$(elem).attr("href");var alp=parseHRef(alink);alink=alp.hash;$.extend(ctx,{actionLink:alink,a:alp,type:'a'});}else{alink=elem.name||elem.value||elem.id;$.extend(ctx,{actionLink:alink,type:'button'});};log(".onClick() callback: '"+tagType+"', actionLink: '"+alink+"', type: '"+ctx.type+"', value: '"+getInputValue(elem)+"' "+(ctx.data?"**FORM DATA**":"")+" (hash: "+route.hash+")");if(self.debugLevel>1&&ctx.data)logd("** DATA FORM for actionLink: '"+alink+"' (in ctx.data) **",ctx.data);if(self.debugLevel>2&&route.model)logd('** ROUTE "'+route.hash+'" DATA MODEL (in route.model) **',route.model);if(typeof ctx.onClick=='function'){deferred(ctx,ctx.onClick,function(){processUdpQueue(ctx);checkToGo(ctx);});if((rv=ctx.proceed(ctx))===undefined){rv=(tagType==='submit')||(tagType==='a'&&alink.indexOf('#_')==0)?false:true;};ctx.resolve();};if(tagType==='a'){var dlang=$(elem).attr(ATTR_DATA_LANG);if(dlang){self.setLanguage(dlang);return false;};};return rv;};updateModel(route,getInputName(elem),getInputValue(elem));updateHots(elem.name,route);log('Was callback CHANGE elem name: \''+getInputName(elem)+'\', value: "'+getInputValue(elem)+'" (hash: '+route.hash+')');return true;};function backBtnCallback(e){currentRoute.thenGo=currentRoute.backBtn||$(e).attr(ATTR_DATA_BACKBTN)||'.back';checkToGo(currentRoute);return true;};function parseHRef(href){var rv={path:'',query:'',hash:''};if(!href)return rv;var p,h=href.indexOf('#'),q=href.indexOf('?');if(h>=0&&q>=0&&h>q){p=href.split(/[?#]/);rv={path:p.shift(),query:p.shift(),hash:'#'+p.shift()};}else if(h>=0&&q>=0&&h<q){p=href.split(/[?#]/);rv={path:p.shift(),hash:'#'+p.shift(),query:p.shift()};}else if(h>=0&&q<0){p=href.split('#');rv={path:p.shift(),query:'',hash:'#'+p.shift()};}else if(h<0&&q>=0){p=href.split('?');rv={path:p.shift(),query:p.shift(),hash:''};}else if(href){rv={path:href,query:'',hash:''};};return rv;};function checkToGo(ctx){if(typeof ctx.thenGo!=='string')return;var f;if(ctx.thenGo.match(/\.back/i)){f=function(){window.history.back();};}else if(ctx.thenGo.match(/\.refresh/i)){f=function(){renderRoute(currentRoute,true);};}else{var new_url;if(ctx.thenGo.match(HTTPMATCH))new_url=ctx.thenGo;else if(ctx.thenGo=='/')new_url='../../';else if(ctx.thenGo.indexOf('/')>=0)new_url=window.location.protocol+'//'+window.location.host+ctx.thenGo;else new_url=ctx.thenGo?"#"+ctx.thenGo:"#";if(ctx.noHistory)f=function(){window.location.replace(new_url);};else f=function(){window.location.assign(new_url);};};ctx.thenGo=null;setTimeout(f,100);};function getFORMData(form){var radios=[],data={};var assign=function(n,v){try{data[(n)]=v;}catch(x){};};$(form).find("input,select").not(":button,:reset,:submit").each(function(i,e){if(!e.name)return;if(String(e.type).match(/radio/i)){if(radios.indexOf(e.name)<0)radios.push(e.name);}else{assign(e.name,getInputValue(e));}});if(radios.length==0)return data;while(radios.length>0){var n=radios.shift(),rv='';$(form).find(":radio[name='"+n+"']").each(function(i,e){if(e.checked){rv=e.value;return false;}});assign(n,rv);};return data;};function renderRoute(route,refreshing){if(!route)return;var jid='#'+options.viewId;var doit=function(rou){$(jid).TExpreso(rou.template,rou.model);if(!refreshing){previousRoute=currentRoute;currentRoute=rou;};rou.displayed=true;$(jid).find("input,select").not(":button,:reset,:submit").change(function(){return inputCallback(this,rou);});$(jid).find("button,a,input[type='button']").not(":submit").click(function(){return inputCallback(this,rou);});$(jid).find("form").submit(function(){return inputCallback(this,rou);});$(jid).find("["+ATTR_DATA_BACKBTN+"]").click(function(){return backBtnCallback(this);});var thenFn;if(rou.hash!==LOADER_ROUTE){thenFn=function(){processUdpQueue(rou);checkToGo(rou);};}else{thenFn=function(){processUdpQueue(rou);hashChange({starting:true,oldURL:null,newURL:window.location.href});};};log('.renderRoute(): '+routeLog(rou));if(typeof rou.started=='function'){deferred(rou,rou.started,thenFn);rou.proceed();rou.resolve();log('.started() called for hash: '+routeLog(rou));}};loadTemplates(route,doit,function(){$(jid).html(options.loadErrorMsg);currentRoute=null;});};function loadTemplates(route,done,fail){var queue=[];var repSymb=function(f){return f.replace('%LANG%',LANGUAGE);};var wdir=function(f,far){return(far?options.appPath+f+options.tplExtension:route.appPath+route.sufixURI+"/"+f+route.tplExtension);};var toLoad=function(f,far){if(f){if(f instanceof Array){for(var i in f){var url=wdir(repSymb(f[i]),far);if(!$.TExpreso.has(f[i])&&!$.TExpreso.hasUrl(url))queue.push(url);}}else{var url=wdir(repSymb(f),far);var xxx=$.TExpreso.has(f);if(!$.TExpreso.has(f)&&!$.TExpreso.hasUrl(url))queue.push(url);}}};toLoad(route.template);toLoad(route.templates);if(!othersLoaded){othersLoaded=true;toLoad(options.others,true);};if(queue.length==0){done(route);return;};var ctx={count:0,hash:route.hash,load:function(cx,q){cx.defer(q.length);for(var i in q){var qq=q[i];$.TExpreso.addFromUrl(q[i],function(cnt,tt){if(cnt!=0){log("<< Remote template loaded: "+tt);cx.count++;}else{console.warn(IAM_ERROR,'!! Template NOT found! (path: '+tt+')');};cx.ready(cx.count);});}}};deferred(ctx,ctx.load,function(count){if(count==queue.length)done(route);else fail();});ctx.proceed(queue);ctx.resolve();};function conventionsAdapter(tplName,content){if(!content)return'';var tag,p2,dones=0,logx=".conventionsAdapter to tpl '"+tplName+"'";var _attrs=function(str,attr){var rv=[],patt=new RegExp(attr+'\\s*=\\s*["\']',"ig"),patt2=/["']/,patt3=/>/,lix,clo,end,tag;while(patt.test(str)==true){var xx=str.slice(patt.lastIndex);if((lix=xx.search(patt2))<0)continue;var at=xx.substring(0,lix).trim();if(at){clo=(clo=xx.search(patt3))>0?clo:0;if(clo>0&&xx.charAt(clo-1)!=='/'){var patt4=new RegExp('</[a-z]+\\s*>','gi');if((tag=(tag=(tag=patt4.exec(xx))?tag[0]:'')?tag.substring(2,tag.length-1):'')){end=patt4.lastIndex-tag.length-3;rv.push({attr:at,close:clo+patt.lastIndex,tag:tag,endtag:end+patt.lastIndex,inner:xx.substring(clo+1,end)});}}}};return rv;};var _adapt=function(str,attr,fnWrite){var dp=_attrs(str,attr);var txt='',p=0;for(var i in dp){txt=txt+str.substring(p,dp[i].close+1)+fnWrite(dp[i]);p=dp[i].endtag;};return(txt+str.slice(p));};if(!(tag=content.match(/<[a-z]+[\s>]/i))){console.warn(IAM,logx+" ***!! POSSIBLE MALFORMED HTML !!***");return content;};content=_adapt(content,ATTR_DATA_PARTIAL,function(d){return"{{> "+d.attr+"}}";});content=_adapt(content,ATTR_DATA_SECTIONKEY,function(d){return"{{#"+d.attr+"}}"+d.inner+"{{/"+d.attr+"}}";});return content;};function hashChange(e){if(inHBackFlag){inHBackFlag=false;return false;};if(/#$/.test(e.newURL)){reject();return false;};var h=window.location.hash.length>0?window.location.hash.slice(1):'';var route;if(!(route=takeRoute(h,window.location.search))){if(String(window.location.href).match(window.location.pathname)){if(h.charAt(0)!=='_')reject("Hash '"+h+"' NOT found, maybe should create it with whenRoute()?",true);}else if(window.location.pathname!=window.location.href){window.location.replace(window.location.pathname);}else{console.warn("Should create at least one route with whenRoute()");};return false;};var cur_hash=currentRoute?currentRoute.hash:null;var mustStart=!route.startOnlyOnce||!route.displayed;if(mustStart&&route.previousHashReq&&route.previousHashReq!==cur_hash){window.location.replace(window.location.pathname+'#'+route.previousHashReq);return false;};var hBack=cur_hash&&(route.autoBack instanceof Array)&&route.autoBack.indexOf(cur_hash)>=0?true:false;if(window.history.length>1&&((route.displayed&&route.autoBack===true)||hBack)){reject("hashChange to '"+h+"' was autoBack'ed...");return false;};log('hashChange - [ '+e.oldURL+' ] >> [ '+e.newURL+' ]');if(mustStart){try{if(typeof route.modelCopyFrom==='function')route.model=route.modelCopyFrom(route,routes);if(typeof route.modelCopyFrom==='string')route.model=$.extend({},getRoute(route.modelCopyFrom).model);if(typeof route.modelCopyFrom==='object')route.model=route.modelCopyFrom;}catch(e){console.error(IAM_ERROR,"Posible Error: Can´t copy model from route '"+route.modelCopyFrom+"'... it don't exists!");};if(typeof route.start=='function'){startRoute(route,reject);return true;}};renderRoute(route);return true;};function reject(msg,isWarn){inHBackFlag=true;if(window.history.length>1)window.history.back();else window.location.replace(window.location.pathname);if(msg)isWarn?console.warn(IAM,"REJECTED 'hashChange'. "+msg):console.info("REJECTED 'hashChange'. "+msg);};function startRoute(route){deferred(route,route.start,function(){renderRoute(route);},function(){reject(null,"rejected by js");});route.proceed();route.resolve();log('.start() called for hash: '+routeLog(route));};function deferred(context,fnproceed,fndone,fnreject){var em=' mal invocado! - context: '+context.hash,d={_stat:{used:0,code:-1},proceed:function(data){if(context._stat.code!=-1)console.error('deferred.proceed()'+em);else{context._stat.code=0;return fnproceed(context,data);}},resolve:function(){if(context._stat.code==0&&context._stat.used<=0)context.ready();},defer:function(n){if(context._stat.code!=0)console.error('deferred.defer()'+em);else context._stat.used+=(n?n:1);},ready:function(data){if(context._stat.code<0)console.error('deferred.ready()'+em);else if(context._stat.code==0&&--context._stat.used<=0){context._stat.code=1;if(typeof fndone==='function')fndone(data);}},reject:function(data){if(context._stat.code==0){context._stat.code=1;if(typeof fnreject==='function')fnreject(data);}},};return $.extend(context,d);};function routeLog(r){var pars=r.params?$.param(r.params).replace(/&/gi,', '):null;return'"'+r.hash+'" - params: '+(pars?pars:'(no)');};function getRoute(hash){var route;if(!hash&&routes.length>0){for(var i in routes){if(routes[i].hash!=LOADER_ROUTE){route=routes[i];break;}};}else{for(var i in routes){if(routes[i].hash==hash){route=routes[i];break;}};};return route;};function takeRoute(hashStr,query){var route,arr,hash;arr=hashStr.split('/');var hash=arr.shift();if(!(route=getRoute(hash)))return null;route.params={};if(route.paramNames){for(var i in route.paramNames){route.params[route.paramNames[i]]=arr.shift();}};route.query=String(query||'').charAt(0)=='?'?query.slice(1):(query||'');return route;};function createRoute(hashStr,ops){if(typeof hashStr!='string'||hashStr.trim().length==0){console.error(IAM_ERROR,ROUTE_ERROR);return null;};var arr=hashStr.split('/@');for(var i in arr){if(!arr[i].match(/^[a-z0-9_-]+$/i)){console.error(IAM_ERROR,ROUTE_ERROR+' -- hash string: "'+hashStr+'"');return null;}};var hash=arr.shift();var route={model:{global:global},hash:hash,template:hash,paramNames:(arr.length>0?arr:null),params:null,displayed:false,autoBack:false};$.extend(route,{appPath:options.appPath,sufixURI:options.sufixURI,tplExtension:options.tplExtension,loadErrorMsg:options.loadErrorMsg,startOnlyOnce:options.startOnlyOnce,},ops,route_methods);return route;};function setModelView(data,ns,ovw){if(!data)return this;var nsh=ns?ns+'.':'';for(var i in data){options.dataAdapter(data[i],nsh+i)};if(ovw===undefined||ovw==false){if(ns){if(this.model[ns]===undefined)this.model[ns]={};$.extend(this.model[ns],data);}else $.extend(this.model,data);}else{if(ns)this.model[ns]=data;else this.model=data;};return this;};function clearModel(){this.model={global:global};return this;};function getModelValue(names,ns,innerNs){names=typeof names==='string'?names.trim().split(PARSEPAT):names;if(typeof ns==='boolean'){innerNs=ns;ns='';}else ns=ns?ns+'.':'';var rv={},route=this;for(var i in names){var o=_oget(route.model,ns+names[i]);if(o){if(!o.type&&typeof o==='object'){var nss='';for(var j in o){nss=nss+j+' ';};$.extend(rv,route.getv(nss,ns+names[i],innerNs));}else{o=o.type===undefined?o:o.type=='checkbox'?o.checked:o.value;var n=ns+names[i];rv[(innerNs?n.slice(n.indexOf('.')+1):n)]=o==undefined?'':o;}}};return rv;};function setModelValue(obj){for(var i in obj){updateModel(this,i,obj[i]);pushToUpdView(i,'js (setv)');};return this;};function pushToUpdView(ref,cause){if((ref=(ref||"").trim())&&!updQueue[ref])updQueue[ref]={cause:(cause?cause:'code')};return this;};function onHelper(elemName,args){var ctx=this,en,qs='',rv;if(typeof elemName==='string')en=ctx.actionLink?ctx.actionLink:ctx.elemName?ctx.elemName:'*?*';else if(typeof elemName==='object'&&args===undefined)args=elemName;if(en){qs=en.split('/');en=qs.shift();qs=qs.length>0?'/'+qs.join('/'):'';};if(!en||en==elemName){log('on "'+elemName+'" correspondido!');var df=args.data||ctx.data;if(typeof df==='string')df=ctx.getv(df);var sdata=$.extend({},{data:df});var exec=function(f,d){return(typeof f==='function')?f(d,ctx):null;};var cbkfn=function(d){if(d.success){if(exec(args.success,d)===false)return;if(args.into)ctx.setModelView(d.result,args.into);else if(args.into!==false)ctx.setModelView(d.result);if(exec(args.complete,d)===false)return;}else{var efn=args.onFault||ctx.onFault||options.onFault;if(typeof efn==='function'){efn(ctx,d);return;}};if(exec(args.allways,d)===false)return;if(!ctx.thenGo){if(typeof args.thenGo==='string')ctx.thenGo=args.thenGo;else ctx.thenGo=exec(args.thenGo,d);};if(args.display)ctx.display(args.display);return d.success?true:false;};var shell=function(d){if(cbkfn(d))ctx.ready();else ctx.reject();};var ag=args.AG||ctx.AG||options.AG;if(ag){ctx.defer();ag.setLanguage(LANGUAGE);qs=args.q?qs+'?'+args.q:qs;if(args.get)ag.get(args.get+qs,shell,sdata);else if(args.post)ag.post(args.post+qs,shell,sdata);}else{console.error(IAM_ERROR,"Must supply AjaxGrails provider in .on() / .make()");};rv=true;};return rv;};function setDisplayed(v){this.getRoute(this.hash).displayed=v?true:false;};function goHelper(url){this.thenGo=!url?'':url;};function display(idsOrSks){idsOrSks=typeof idsOrSks==='string'?idsOrSks.split(PARSEPAT):idsOrSks;for(var i in idsOrSks){if(idsOrSks[i])pushToUpdView(idsOrSks[i]);};};var route_methods={getRoute:getRoute,clear:clearModel,setModelView:setModelView,getv:getModelValue,setv:setModelValue,display:display,on:onHelper,make:onHelper,setDisplayed:setDisplayed,go:goHelper,adapt:options.dataAdapter,};this.whenRoute=function(hash,ops){var route;if(!(route=createRoute(hash,ops)))return{};routes.push(route);return route;};this.whenLoader=function(ops){return self.whenRoute(LOADER_ROUTE,ops);};this.setLanguage=function(lang,reload){if(lang&&lang!=LANGUAGE){docCookies.setItem(COOKIE_LANG,lang,Infinity,(/\/[a-z0-9-_\$\.;,%]+/i.exec(location.pathname)));if(options.AG)options.AG.setLanguage(lang);if(reload||reload===undefined)window.location.reload();else LANGUAGE=lang;}};this.getLanguage=function(){return LANGUAGE;};this.start=function(opts){if(started)return;started=true;$.extend(options,opts);$('document').ready(function(){LANGUAGE=(docCookies.getItem(COOKIE_LANG)||window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage).substring(0,2);if(options.AG)options.AG.setLanguage(LANGUAGE);log('## Start ClientMVC v'+VERSION+' ## - LANGUAGE: "'+LANGUAGE+'" ##');if(options.viewId&&document.getElementById(options.viewId)==null){$(APPENDVIEW_SELECTOR+' :first').prepend('<div id="'+options.viewId+'">');if(document.getElementById(options.viewId)==null)console.error(IAM_ERROR,"Could not find the element w/ id='"+options.viewId+"' or classes "+APPENDVIEW_SELECTOR+" (required for stamp templates)!");return;};if(routes.length<1){console.error(IAM_ERROR,"No route was defined !");return;};if(window.dataAdapter)options.dataAdapter=window.dataAdapter;else log('Warning! No data adapter was defined ! (should load dataAdapter.js)');$.TExpreso.setAddInterceptor(conventionsAdapter);$.TExpreso.addFromDom();window.onhashchange=hashChange;var loader=getRoute(LOADER_ROUTE);if(loader){if(typeof loader.start=='function')startRoute(loader);else renderRoute(loader);}else{hashChange({starting:true,oldURL:null,newURL:window.location.href});};$("["+ATTR_DATA_BACKBTN+"]").click(function(){return backBtnCallback(this);});});};this.log=function(c,d){logd((c!=undefined?c:currentRoute),d);};function log(t1,t2){if(self.debugLevel<1)return;if(!self.debugLogId){if(t2)console.info(t1,t2);else console.info(t1);}else{$('#'+self.debugLogId).append(t1+' '+(t2?t2:'')+'<br>')};};function logd(c,d,t){t=t?t:'\t';if(d==undefined)d=c;else if(c)log(c);for(var n in d){if(typeof d[n]=='function')continue;if(n.substring(0,2)=='_$'&&self.debugLevel<4)continue;log(t+n+' = '+d[n]);if(typeof d[n]=='object')logd('',d[n],t+'\t');}};};if(!window.ClientMVC){window.ClientMVC=new ClientMVC();window.MVC=window.ClientMVC;};}(window,jQuery,docCookies));(function(window){if("onhashchange"in window.document.body){return;};var location=window.location,oldURL=location.href,oldHash=location.hash;setInterval(function(){var newURL=location.href,newHash=location.hash;if(newHash!=oldHash&&typeof window.onhashchange==="function"){window.onhashchange({type:"hashchange",oldURL:oldURL,newURL:newURL});oldURL=newURL;oldHash=newHash;}},100);})(window);